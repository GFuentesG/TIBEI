<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Pacientes</title>
    <link rel="stylesheet" href="styles.css">
    <script src="js/get_paciente.js" defer></script> <!-- Script para obtener los pacientes -->
    <script src="js/post_paciente.js" defer></script>
    <script src="js/delete_paciente.js" defer></script>
    <script src="js/update_paciente.js" defer></script>
    <script src="js/get_paciente_dni.js" defer></script>
    <script src="js/paciente_tabs.js" defer></script> <!-- Manejo de las pestañas -->
    <style>
        /* Alinear los botones en una sola fila */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .tab-button {
            display: inline-block;
            padding: 10px 20px;
            margin-right: 5px;
            background-color: #1a73e8;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }

        .tab-button.active {
            background-color: #155aaf;
        }

        .tab-button:hover {
            background-color: #357abd;
        }

        /* Botón para volver al índice */
        #back-button {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #555;
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
        }

        #back-button:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
<!-- Botón de regreso al index -->
<a href="index.html" id="back-button">Regresar</a>

<!-- Encabezado -->
<header class="header">
    <h1>Gestión de Pacientes</h1>
</header>

<!-- Contenedor principal -->
<main class="container">
    <div class="tabs">
        <!-- Pestañas -->
        <button class="tab-button" onclick="openTab(event, 'alta')">Alta Paciente</button>
        <button class="tab-button active" onclick="openTab(event, 'listado')">Listado de Pacientes</button> <!-- Por defecto, listado activo -->
        <button class="tab-button" onclick="openTab(event, 'actualizar')">Actualizar Paciente</button>
        <button class="tab-button" onclick="openTab(event, 'eliminar')">Eliminar Paciente</button>
        <button class="tab-button" onclick="openTab(event, 'buscar')">Buscar por DNI</button>
    </div>

    <!-- Sección Listado de Pacientes -->
    <div id="listado" class="tab-content" style="display: block;">
        <h2>Listado de Pacientes</h2>
        <table id="pacienteTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>DNI</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <!-- Los pacientes serán listados por el script get_paciente.js -->
            </tbody>
        </table>
    </div>

    <!-- Sección Alta de Pacientes -->
    <div id="alta" class="tab-content" style="display: none;">
        <h2>Alta de Paciente</h2>
        <form id="form-alta">
            <label for="nombre-alta">Nombre:</label>
            <input type="text" id="nombre-alta" name="nombre" required>

            <label for="apellido-alta">Apellido:</label>
            <input type="text" id="apellido-alta" name="apellido" required>

            <label for="dni-alta">DNI:</label>
            <input type="text" id="dni-alta" name="dni" required>

            <label for="domicilio-alta">Domicilio:</label> <!-- Nuevo campo para domicilio -->
            <input type="text" id="domicilio-alta" name="domicilio" required>

            <button type="submit">Registrar Paciente</button>
        </form>
    </div>

    <!-- Sección Actualizar Paciente -->
    <div id="actualizar" class="tab-content" style="display: none;">
        <h2>Actualizar Paciente</h2>
        <form id="form-actualizar">
            <label for="paciente_id-actualizar">ID:</label>
            <input type="text" id="paciente_id-actualizar" name="paciente_id" required readonly
                   style="background-color: #e9ecef; cursor: not-allowed; border: 1px solid #ced4da;"> <!-- Estilos para no editable -->

            <label for="nombre-actualizar">Nuevo Nombre:</label>
            <input type="text" id="nombre-actualizar" name="nombre">

            <label for="apellido-actualizar">Nuevo Apellido:</label>
            <input type="text" id="apellido-actualizar" name="apellido">

            <label for="dni-actualizar">Nuevo DNI:</label>
            <input type="text" id="dni-actualizar" name="dni">

            <label for="domicilio-actualizar">Nuevo Domicilio:</label>
            <input type="text" id="domicilio-actualizar" name="domicilio">

            <button type="submit">Actualizar Paciente</button>
        </form>
    </div>



    <!-- Sección Eliminar Paciente -->
    <div id="eliminar" class="tab-content" style="display: none;">
        <h2>Eliminar Paciente</h2>
        <form id="form-eliminar">
            <label for="dni-eliminar">DNI del Paciente:</label>
            <input type="text" id="dni-eliminar" name="dni-eliminar" required>
            <button type="submit">Eliminar Paciente</button>
        </form>
    </div>

    <!-- Sección Buscar por DNI -->
    <div id="buscar" class="tab-content" style="display: none;">
        <h2>Buscar Paciente por DNI</h2>
        <form id="form-buscar">
            <label for="dni-buscar">DNI:</label>
            <input type="text" id="dni-buscar" name="dni" required>
            <button type="button" id="buscar_paciente_btn">Buscar</button>
        </form>

        <!-- Resultados de la búsqueda -->
        <div id="paciente_resultado" style="display: none;">
            <h3>Resultado:</h3>
            <table id="pacienteTableBody">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>DNI</th>
                </tr>
                </thead>
                <tbody>
                <!-- Los resultados serán agregados aquí -->
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- Pie de página -->
<footer>
    <p>&copy; 2024 Gestión de Pacientes. Todos los derechos reservados.</p>
</footer>

<script>
    // Confirmación antes de realizar el alta
    document.querySelector('#form-alta').addEventListener('submit', function (event) {
        if (!confirm('¿Estás seguro de que deseas registrar este paciente?')) {
            event.preventDefault();
        }
    });

    // Confirmación antes de actualizar
    document.querySelector('#form-actualizar').addEventListener('submit', function (event) {
        if (!confirm('¿Estás seguro de que deseas actualizar los datos de este paciente?')) {
            event.preventDefault();
        }
    });

    // Confirmación antes de eliminar
    document.querySelector('#form-eliminar').addEventListener('submit', function (event) {
        if (!confirm('¿Estás seguro de que deseas eliminar este paciente?')) {
            event.preventDefault();
        }
    });

    // Función para cargar los pacientes en la tabla
    window.addEventListener('load', function () {
        (function() {
            const url = '/pacientes';  // Endpoint para obtener los pacientes
            const settings = {
                method: 'GET'
            };

            // Llamada a la API para obtener los pacientes
            fetch(url, settings)
            .then(response => response.json())
            .then(data => {
                console.log(data); // Verificación de los datos en la consola
                // Obtenemos la tabla donde vamos a insertar los datos
                let tableBody = document.querySelector("#pacienteTable tbody");

                // Limpiar contenido previo (si existe)
                tableBody.innerHTML = '';

                // Iteramos sobre los pacientes recibidos
                for (let paciente of data) {
                    // Creamos una fila para cada paciente
                    let row = tableBody.insertRow();

                    // Insertamos celdas en la fila
                    let cellId = row.insertCell(0);
                    let cellNombre = row.insertCell(1);
                    let cellApellido = row.insertCell(2);
                    let cellDni = row.insertCell(3);

                    // Asignamos los datos a las celdas
                    cellId.innerHTML = paciente.id;
                    cellNombre.innerHTML = paciente.nombre;
                    cellApellido.innerHTML = paciente.apellido;
                    cellDni.innerHTML = paciente.dni;

                    // Crear celdas de acciones
                    let cellActions = row.insertCell(4);
                    cellActions.innerHTML = `
                        <button onclick="deleteBy(${paciente.id})">Eliminar</button>
                        <button onclick="findBy(${paciente.id})">Actualizar</button>
                    `;
                }
            })
            .catch(error => {
                console.error('Error al cargar los pacientes:', error);
            });
        })();
    });
</script>

</body>
</html>
